import e from"url-join";class t{constructor(t,n){this.eventSource=void 0,this._callbacks=void 0,this.onOpenBound=void 0,this.onErrorBound=void 0,this.closeBound=void 0;const o=n?e(t,n):t;this.eventSource=new EventSource(o),this.onOpenBound=this.onOpen.bind(this),this.onErrorBound=this.onError.bind(this),this.closeBound=this.close.bind(this),this.eventSource.addEventListener("open",this.onOpenBound),this.eventSource.addEventListener("error",this.onErrorBound),this.eventSource.addEventListener("close",this.closeBound),this._callbacks={}}onOpen(e){}onError(e){}close(){this.eventSource&&(this.eventSource.removeEventListener("open",this.onOpenBound),this.eventSource.removeEventListener("error",this.onErrorBound),this.eventSource.removeEventListener("close",this.closeBound),this.removeAllEventListener(),this.eventSource.close(),this.eventSource=null)}addEventListener(e,t){var n;const o=n=>{const o=JSON.parse(n.data);t({type:e,data:o})};return this.removeEventListener(e),this._callbacks[e]=o,null==(n=this.eventSource)||n.addEventListener(e,o),()=>this.removeEventListener(e)}removeEventListener(e){const t=this._callbacks[e];var n;t&&(null==(n=this.eventSource)||n.removeEventListener(e,t),delete this._callbacks[e])}removeAllEventListener(){Object.keys(this._callbacks).forEach(e=>this.removeEventListener(e))}}export{t as Client};
//# sourceMappingURL=client.modern.js.map
