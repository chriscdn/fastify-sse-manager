{"version":3,"file":"client.cjs","sources":["../src/client.ts"],"sourcesContent":["class Client<T> {\n  private eventSource: EventSource | null;\n  private _callbacks: Record<string, any>;\n\n  constructor(private path: string) {\n    //}, private channel: string) {\n    // const fullPath: string = urljoin(path, channel);\n\n    this.eventSource = new EventSource(path);\n    // this.channel = channel;\n\n    // open and error are reserved\n    this.eventSource.addEventListener(\"open\", this.onOpen.bind(this));\n    this.eventSource.addEventListener(\"error\", this.onError.bind(this));\n\n    // close is a standard message, hijacked for our purposes\n    this.eventSource.addEventListener(\"close\", this.close.bind(this));\n\n    // keep record of our callback functions to make them available to removeEventListener\n    this._callbacks = {};\n  }\n\n  onOpen(event: MessageEvent) {\n    // console.log(\"onOpen\");\n  }\n  onError(event: MessageEvent) {\n    // console.log(\"onError\");\n  }\n\n  close() {\n    this.eventSource?.close();\n    this.eventSource = null;\n    this._callbacks = {};\n  }\n\n  addEventListener<T>(\n    eventName: string,\n    _callback: ({ type, data }: { type: string; data: T }) => void,\n  ) {\n    const callback = (event: MessageEvent) => {\n      const type: string = event.type;\n      const data: T = JSON.parse(event.data);\n\n      _callback({\n        type,\n        data,\n      });\n    };\n\n    // Only one listenter at a time.  If a second is needed, then change the code and document why.\n    this.removeEventListener(eventName);\n\n    this._callbacks[eventName] = callback;\n\n    this.eventSource?.addEventListener(eventName, callback);\n  }\n\n  removeEventListener(eventName: string) {\n    const callback = this._callbacks[eventName];\n\n    if (callback) {\n      this.eventSource?.removeEventListener(eventName, callback);\n      delete this._callbacks[eventName];\n    }\n  }\n}\n\nexport { Client };\n"],"names":["Client","path","this","eventSource","_callbacks","EventSource","addEventListener","onOpen","bind","onError","close","_proto","prototype","event","_this$eventSource","eventName","_callback","_this$eventSource2","callback","type","data","JSON","parse","removeEventListener","_this$eventSource3"],"mappings":"4BAAY,WAIV,SAAAA,EAAoBC,GAAYC,KAAZD,UAAA,EAAAC,KAHZC,iBACAC,EAAAA,KAAAA,gBAEY,EAAAF,KAAID,KAAJA,EAIlBC,KAAKC,YAAc,IAAIE,YAAYJ,GAInCC,KAAKC,YAAYG,iBAAiB,OAAQJ,KAAKK,OAAOC,KAAKN,OAC3DA,KAAKC,YAAYG,iBAAiB,QAASJ,KAAKO,QAAQD,KAAKN,OAG7DA,KAAKC,YAAYG,iBAAiB,QAASJ,KAAKQ,MAAMF,KAAKN,OAG3DA,KAAKE,WAAa,CAAA,CACpB,CAAC,IAAAO,EAAAX,EAAAY,UA4CA,OA5CAD,EAEDJ,OAAA,SAAOM,GAEN,EAAAF,EACDF,QAAA,SAAQI,GAAmB,EAE1BF,EAEDD,MAAA,eAAKI,EACHA,OAAAA,OAAKX,cAALW,EAAkBJ,QAClBR,KAAKC,YAAc,KACnBD,KAAKE,WAAa,CACpB,CAAA,EAACO,EAEDL,iBAAA,SACES,EACAC,GAA8DC,IAAAA,EAExDC,EAAW,SAACL,GAChB,IAAMM,EAAeN,EAAMM,KACrBC,EAAUC,KAAKC,MAAMT,EAAMO,MAEjCJ,EAAU,CACRG,KAAAA,EACAC,KAAAA,GAEJ,EAGAlB,KAAKqB,oBAAoBR,GAEzBb,KAAKE,WAAWW,GAAaG,EAEb,OAAhBD,EAAIf,KAACC,cAALc,EAAkBX,iBAAiBS,EAAWG,EAChD,EAACP,EAEDY,oBAAA,SAAoBR,GAClB,IAEcS,EAFRN,EAAWhB,KAAKE,WAAWW,GAE7BG,IACFM,OAAAA,OAAKrB,cAALqB,EAAkBD,oBAAoBR,EAAWG,UAC1ChB,KAAKE,WAAWW,GAE3B,EAACf,CAAA,CAhES"}