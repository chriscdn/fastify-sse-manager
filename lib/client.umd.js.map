{"version":3,"file":"client.umd.js","sources":["../node_modules/url-join/lib/url-join.js","../client/index.js"],"sourcesContent":["function normalize (strArray) {\n  var resultArray = [];\n  if (strArray.length === 0) { return ''; }\n\n  if (typeof strArray[0] !== 'string') {\n    throw new TypeError('Url must be a string. Received ' + strArray[0]);\n  }\n\n  // If the first part is a plain protocol, we combine it with the next part.\n  if (strArray[0].match(/^[^/:]+:\\/*$/) && strArray.length > 1) {\n    var first = strArray.shift();\n    strArray[0] = first + strArray[0];\n  }\n\n  // There must be two or three slashes in the file protocol, two slashes in anything else.\n  if (strArray[0].match(/^file:\\/\\/\\//)) {\n    strArray[0] = strArray[0].replace(/^([^/:]+):\\/*/, '$1:///');\n  } else {\n    strArray[0] = strArray[0].replace(/^([^/:]+):\\/*/, '$1://');\n  }\n\n  for (var i = 0; i < strArray.length; i++) {\n    var component = strArray[i];\n\n    if (typeof component !== 'string') {\n      throw new TypeError('Url must be a string. Received ' + component);\n    }\n\n    if (component === '') { continue; }\n\n    if (i > 0) {\n      // Removing the starting slashes for each component but the first.\n      component = component.replace(/^[\\/]+/, '');\n    }\n    if (i < strArray.length - 1) {\n      // Removing the ending slashes for each component but the last.\n      component = component.replace(/[\\/]+$/, '');\n    } else {\n      // For the last component we will combine multiple slashes to a single one.\n      component = component.replace(/[\\/]+$/, '/');\n    }\n\n    resultArray.push(component);\n\n  }\n\n  var str = resultArray.join('/');\n  // Each input component is now separated by a single slash except the possible first plain protocol part.\n\n  // remove trailing slash before parameters or hash\n  str = str.replace(/\\/(\\?|&|#[^!])/g, '$1');\n\n  // replace ? in parameters with &\n  var parts = str.split('?');\n  str = parts.shift() + (parts.length > 0 ? '?': '') + parts.join('&');\n\n  return str;\n}\n\nexport default function urlJoin() {\n  var input;\n\n  if (typeof arguments[0] === 'object') {\n    input = arguments[0];\n  } else {\n    input = [].slice.call(arguments);\n  }\n\n  return normalize(input);\n}\n","import urljoin from 'url-join'\n\nclass Client {\n  constructor(path, channel) {\n    const fullPath = urljoin(path, channel)\n\n    this.eventSource = new EventSource(fullPath)\n    this.channel = channel\n\n    // open and error are reserved\n    this.eventSource.addEventListener('open', this.onOpen.bind(this))\n    this.eventSource.addEventListener('error', this.onError.bind(this))\n\n    // close is a standard message, hijacked for our purposes\n    this.eventSource.addEventListener('close', this.close.bind(this))\n\n    // keep record of our callback functions to make them available to removeEventListener\n    this._callbacks = {}\n  }\n\n  onOpen(event) {}\n  onError(event) {}\n\n  close(event) {\n    this.eventSource.close()\n    this.eventSource = null\n  }\n\n  addEventListener(eventName, _callback) {\n    const callback = (event) => {\n      const type = event.type\n      const data = JSON.parse(event.data)\n\n      _callback({\n        type,\n        data,\n      })\n    }\n\n    // Only one listenter at a time.  If a second is needed, then change the code and document why.\n    this.removeEventListener(eventName)\n\n    this._callbacks[eventName] = callback\n    this.eventSource.addEventListener(eventName, callback)\n  }\n\n  removeEventListener(eventName) {\n    const callback = this._callbacks[eventName]\n    if (callback) {\n      this.eventSource.removeEventListener(eventName, callback)\n      delete this._callbacks[eventName]\n    }\n  }\n}\n\nexport default Client\n"],"names":["normalize","strArray","resultArray","length","TypeError","match","first","shift","replace","i","component","push","str","join","parts","split","urlJoin","input","arguments","slice","call","Client","constructor","path","channel","fullPath","urljoin","eventSource","EventSource","addEventListener","onOpen","bind","onError","close","_callbacks","event","eventName","_callback","callback","type","data","JSON","parse","removeEventListener"],"mappings":";;;;;;EAAA,SAASA,SAAT,CAAoBC,QAApB,EAA8B;EAC5B,MAAIC,WAAW,GAAG,EAAlB;;EACA,MAAID,QAAQ,CAACE,MAAT,KAAoB,CAAxB,EAA2B;EAAE,WAAO,EAAP;EAAY;;EAEzC,MAAI,OAAOF,QAAQ,CAAC,CAAD,CAAf,KAAuB,QAA3B,EAAqC;EACnC,UAAM,IAAIG,SAAJ,CAAc,oCAAoCH,QAAQ,CAAC,CAAD,CAA1D,CAAN;EACD,GAN2B;;;EAS5B,MAAIA,QAAQ,CAAC,CAAD,CAAR,CAAYI,KAAZ,CAAkB,cAAlB,KAAqCJ,QAAQ,CAACE,MAAT,GAAkB,CAA3D,EAA8D;EAC5D,QAAIG,KAAK,GAAGL,QAAQ,CAACM,KAAT,EAAZ;EACAN,IAAAA,QAAQ,CAAC,CAAD,CAAR,GAAcK,KAAK,GAAGL,QAAQ,CAAC,CAAD,CAA9B;EACD,GAZ2B;;;EAe5B,MAAIA,QAAQ,CAAC,CAAD,CAAR,CAAYI,KAAZ,CAAkB,cAAlB,CAAJ,EAAuC;EACrCJ,IAAAA,QAAQ,CAAC,CAAD,CAAR,GAAcA,QAAQ,CAAC,CAAD,CAAR,CAAYO,OAAZ,CAAoB,eAApB,EAAqC,QAArC,CAAd;EACD,GAFD,MAEO;EACLP,IAAAA,QAAQ,CAAC,CAAD,CAAR,GAAcA,QAAQ,CAAC,CAAD,CAAR,CAAYO,OAAZ,CAAoB,eAApB,EAAqC,OAArC,CAAd;EACD;;EAED,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,QAAQ,CAACE,MAA7B,EAAqCM,CAAC,EAAtC,EAA0C;EACxC,QAAIC,SAAS,GAAGT,QAAQ,CAACQ,CAAD,CAAxB;;EAEA,QAAI,OAAOC,SAAP,KAAqB,QAAzB,EAAmC;EACjC,YAAM,IAAIN,SAAJ,CAAc,oCAAoCM,SAAlD,CAAN;EACD;;EAED,QAAIA,SAAS,KAAK,EAAlB,EAAsB;EAAE;EAAW;;EAEnC,QAAID,CAAC,GAAG,CAAR,EAAW;EACT;EACAC,MAAAA,SAAS,GAAGA,SAAS,CAACF,OAAV,CAAkB,QAAlB,EAA4B,EAA5B,CAAZ;EACD;;EACD,QAAIC,CAAC,GAAGR,QAAQ,CAACE,MAAT,GAAkB,CAA1B,EAA6B;EAC3B;EACAO,MAAAA,SAAS,GAAGA,SAAS,CAACF,OAAV,CAAkB,QAAlB,EAA4B,EAA5B,CAAZ;EACD,KAHD,MAGO;EACL;EACAE,MAAAA,SAAS,GAAGA,SAAS,CAACF,OAAV,CAAkB,QAAlB,EAA4B,GAA5B,CAAZ;EACD;;EAEDN,IAAAA,WAAW,CAACS,IAAZ,CAAiBD,SAAjB;EAED;;EAED,MAAIE,GAAG,GAAGV,WAAW,CAACW,IAAZ,CAAiB,GAAjB,CAAV,CA9C4B;EAiD5B;;EACAD,EAAAA,GAAG,GAAGA,GAAG,CAACJ,OAAJ,CAAY,iBAAZ,EAA+B,IAA/B,CAAN,CAlD4B;;EAqD5B,MAAIM,KAAK,GAAGF,GAAG,CAACG,KAAJ,CAAU,GAAV,CAAZ;EACAH,EAAAA,GAAG,GAAGE,KAAK,CAACP,KAAN,MAAiBO,KAAK,CAACX,MAAN,GAAe,CAAf,GAAmB,GAAnB,GAAwB,EAAzC,IAA+CW,KAAK,CAACD,IAAN,CAAW,GAAX,CAArD;EAEA,SAAOD,GAAP;EACD;;EAEc,SAASI,OAAT,GAAmB;EAChC,MAAIC,KAAJ;;EAEA,MAAI,OAAOC,SAAS,CAAC,CAAD,CAAhB,KAAwB,QAA5B,EAAsC;EACpCD,IAAAA,KAAK,GAAGC,SAAS,CAAC,CAAD,CAAjB;EACD,GAFD,MAEO;EACLD,IAAAA,KAAK,GAAG,GAAGE,KAAH,CAASC,IAAT,CAAcF,SAAd,CAAR;EACD;;EAED,SAAOlB,SAAS,CAACiB,KAAD,CAAhB;EACD;;ECnED,MAAMI,MAAN,CAAa;EACXC,EAAAA,WAAW,CAACC,IAAD,EAAOC,OAAP,EAAgB;EACzB,UAAMC,QAAQ,GAAGC,OAAO,CAACH,IAAD,EAAOC,OAAP,CAAxB;EAEA,SAAKG,WAAL,GAAmB,IAAIC,WAAJ,CAAgBH,QAAhB,CAAnB;EACA,SAAKD,OAAL,GAAeA,OAAf,CAJyB;;EAOzB,SAAKG,WAAL,CAAiBE,gBAAjB,CAAkC,MAAlC,EAA0C,KAAKC,MAAL,CAAYC,IAAZ,CAAiB,IAAjB,CAA1C;EACA,SAAKJ,WAAL,CAAiBE,gBAAjB,CAAkC,OAAlC,EAA2C,KAAKG,OAAL,CAAaD,IAAb,CAAkB,IAAlB,CAA3C,EARyB;;EAWzB,SAAKJ,WAAL,CAAiBE,gBAAjB,CAAkC,OAAlC,EAA2C,KAAKI,KAAL,CAAWF,IAAX,CAAgB,IAAhB,CAA3C,EAXyB;;EAczB,SAAKG,UAAL,GAAkB,EAAlB;EACD;;EAEDJ,EAAAA,MAAM,CAACK,KAAD,EAAQ;;EACdH,EAAAA,OAAO,CAACG,KAAD,EAAQ;;EAEfF,EAAAA,KAAK,CAACE,KAAD,EAAQ;EACX,SAAKR,WAAL,CAAiBM,KAAjB;EACA,SAAKN,WAAL,GAAmB,IAAnB;EACD;;EAEDE,EAAAA,gBAAgB,CAACO,SAAD,EAAYC,SAAZ,EAAuB;EACrC,UAAMC,QAAQ,GAAIH,KAAD,IAAW;EAC1B,YAAMI,IAAI,GAAGJ,KAAK,CAACI,IAAnB;EACA,YAAMC,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWP,KAAK,CAACK,IAAjB,CAAb;;EAEAH,MAAAA,SAAS,CAAC;EACRE,QAAAA,IADQ;EAERC,QAAAA;EAFQ,OAAD,CAAT;EAID,KARD,CADqC;;;EAYrC,SAAKG,mBAAL,CAAyBP,SAAzB;EAEA,SAAKF,UAAL,CAAgBE,SAAhB,IAA6BE,QAA7B;EACA,SAAKX,WAAL,CAAiBE,gBAAjB,CAAkCO,SAAlC,EAA6CE,QAA7C;EACD;;EAEDK,EAAAA,mBAAmB,CAACP,SAAD,EAAY;EAC7B,UAAME,QAAQ,GAAG,KAAKJ,UAAL,CAAgBE,SAAhB,CAAjB;;EACA,QAAIE,QAAJ,EAAc;EACZ,WAAKX,WAAL,CAAiBgB,mBAAjB,CAAqCP,SAArC,EAAgDE,QAAhD;EACA,aAAO,KAAKJ,UAAL,CAAgBE,SAAhB,CAAP;EACD;EACF;;EAlDU;;;;;;;;"}